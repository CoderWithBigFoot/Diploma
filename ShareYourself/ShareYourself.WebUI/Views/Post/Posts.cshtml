@using ShareYourself.Business.Dto
@model PostFilters
@{
    ViewBag.Title = "Posts";
    Layout = "~/Views/Shared/_MainLayout.cshtml";
}

@section Styles{
    @Styles.Render("~/Content/Post.css")
}

@section Scripts{
    @Scripts.Render("~/bundles/PostsInteraction")
<script>
        $(function () {

            let selectedFilter = '@Model.ToString()';

            let freshForm = $('#freshForm');
            let updatesForm = $('#updatesForm');
            let likedForm = $('#likedForm');
            let inputSelector = 'input[name="filter"]';
            let selectedFormClass = 'selected-form';
            let showNextPostsFormFilter = $('#show-next-posts-form-filter');

            showNextPostsFormFilter.val(selectedFilter);

            switch (@Model) {
                case @PostFilters.Fresh: freshForm.addClass(selectedFormClass);
                case @PostFilters.Updates: updatesForm.addClass(selectedFormClass);
                case @PostFilters.Liked: likedForm.addClass(selectedFormClass);
            }
            // Error in the script (server always receives single value)

            freshForm.submit(function (event) {
                event.preventDefault();

                if (freshForm.find(inputSelector).val() == selectedFilter){
                    return false;
                }
                return true;
            });

            updatesForm.submit(function (event) {
                event.preventDefault();

                if (updatesForm.find(inputSelector).val() == selectedFilter){
                    return false;
                }
                return true;
            });

            likedForm.submit(function (event) {
                event.preventDefault();

                if (likedForm.find(inputSelector).val() == selectedFilter){
                    return false;
                }
                return true;
            });
        });
</script>
}

@section Body{

    @{ 
        var countOfPostsToTake = 3;

        var getPostsAjaxOptions = new AjaxOptions
        {
            InsertionMode = InsertionMode.InsertAfter,
            HttpMethod = "Get",
            UpdateTargetId = "posts"
        };
     }

    @using (Html.BeginForm("Posts", "Post", FormMethod.Get, new { @class = "filter-form selected-form", @id = "freshForm" }))
    {
        <input type="text" value="@PostFilters.Fresh.ToString()" name="filter" hidden>
        <input type="number" value="@countOfPostsToTake" name="count" hidden>

        <button type="submit" class="page-name">Fresh</button>
    }
    @using (Html.BeginForm("Posts", "Post", FormMethod.Get, new { @class = "filter-form", @id = "updatesForm" }))
    {
        <input type="text" value="@PostFilters.Updates.ToString()" name="filter" hidden>
        <input type="number" value="@countOfPostsToTake" name="count" hidden>

        <button type="submit" class="page-name">Updates</button>
    }
    @using (Html.BeginForm("Posts", "Post", FormMethod.Get, new { @class = "filter-form", @id = "likedForm"}))
    {
        <input type="text" value="@PostFilters.Liked.ToString()" name="filter" hidden>
        <input type="number" value="@countOfPostsToTake" name="count" hidden>

        <button type="submit" class="page-name">Liked</button>
    }
    <hr class="divide-content">

    @{Html.RenderAction("GetPostsByFilter", "Post", new { filter = Model.ToString(), skip = 0, count = countOfPostsToTake });}
    <div id="posts"></div>



<div class="main-content-nested-container">
    @using (Ajax.BeginForm("GetPostsByFilter", "Post", getPostsAjaxOptions))
    {
        <input type="text" value="@PostFilters.Fresh.ToString()" name="filter" id="show-next-posts-form-filter" hidden>
        <input type="number" name="skip" id="input-skip" hidden>
        <input type="number" value="@countOfPostsToTake" name="count" hidden>

        <button type="submit" class="show-next-posts-button" onclick="inputSkipInit('input-skip')">
            <span class="glyphicon glyphicon-chevron-down" id="showNextPostsSpan"></span>
        </button>
    }
</div> 
    }

